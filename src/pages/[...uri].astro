---
import { getNodeByURL } from "../helpers";
import Shop from "../templates/Shop.astro";
import AllProjects from "../templates/AllProjects.astro";
import GetInvolved from "../templates/GetInvolved.astro";

import SingleProduct from "../templates/SingleProduct.astro";
import SingleProject from "../templates/SingleProject.astro";
import Error404 from "../templates/404.astro";

const url = `/${Astro.params.uri}/`;
const data = await getNodeByURL(url);
const node = data.nodeByUri;

function resolveContentTemplate(node) {
  let template;
  console.log(17, node);

  if (!node) {
    template = Error404;
  } else {
    if (node.__typename === "Page") {
      switch (node.template.templateName) {
        case "Shop":
          template = Shop;
          break;

        case "All Projects":
          template = AllProjects;
          break;

        case "Get Involved":
          template = GetInvolved;
          break;
      }
    } else if (node.__typename === "Product") {
      template = SingleProduct;
    } else if (node.__typename === "Project") {
      template = SingleProject;
    }
  }

  if (typeof template === "undefined") {
    template = Error404;
  }

  return template;
}

const Template = resolveContentTemplate(node);
---

<Template title={node ? node.title : "404"} data={node} />
