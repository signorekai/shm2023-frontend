---
import { getNodeByURL } from "../helpers";
import Shop from "../templates/Shop.astro";
import AllProjects from "../templates/AllProjects.astro";
import AllPeople from "../templates/AllPeople.astro";
import GetInvolved from "../templates/GetInvolved.astro";
import AboutUs from "../templates/AboutUs.astro";
import HomePage from "../templates/HomePage.astro";
import Page from "../templates/Page.astro";

import SingleProduct from "../templates/SingleProduct.astro";
import SingleProject from "../templates/SingleProject.astro";
import Error404 from "../templates/404.astro";

let url = `/`;
if (Astro.params.uri) {
  url = `/${Astro.params.uri}/`;
}

const {
  nodeByUri: node,
  desktopNav,
  mobileNav,
  footerNav,
} = await getNodeByURL(url);

function resolveContentTemplate(node) {
  let template;

  if (!node) {
    template = Error404;
  } else {
    if (node.__typename === "Page") {
      switch (node.template.templateName) {
        case "Shop":
          template = Shop;
          break;

        case "All Projects":
          template = AllProjects;
          break;

        case "Get Involved":
          template = GetInvolved;
          break;

        case "People":
          template = AllPeople;
          break;

        case "About Us":
          template = AboutUs;
          break;

        case "Home Page":
          template = HomePage;

          break;

        default:
          template = Page;
          break;
      }
    } else if (node.__typename === "Product") {
      template = SingleProduct;
    } else if (node.__typename === "Project") {
      template = SingleProject;
    } else if (node.__typename === "ContentType") {
      switch (node.name) {
        case "person":
          template = AllPeople;
          break;
      }
    }
  }

  if (typeof template === "undefined") {
    template = Error404;
  }

  return template;
}

const Template = resolveContentTemplate(node);
---

<Template
  title={node ? node.title : "404"}
  data={{ ...node, desktopNav, mobileNav, footerNav }}
/>
