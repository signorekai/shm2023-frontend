---
import { getImage, Image } from "astro:assets";

const props = Astro.props;

if (props.alt === undefined || props.alt === null) {
  throw new Error();
}

// As a convenience, allow width and height to be string with a number in them, to match HTML's native `img`.
if (typeof props.width === "string") {
  props.width = parseInt(props.width);
}

if (typeof props.height === "string") {
  props.height = parseInt(props.height);
}

let image = props;

if (import.meta.env.PROD) {
  image = await getImage(props);
}
---

<>
  {
    import.meta.env.PROD ? (
      <img
        src={image.src}
        width={props.width}
        height={props.height}
        alt={props.alt}
        class={props.class}
      />
    ) : (
      <img
        src={image.src}
        width={props.width}
        height={props.height}
        alt={props.alt}
        class={props.class}
      />
    )
  }
</>
